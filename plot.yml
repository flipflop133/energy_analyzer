energytrackr:
  data:
    csv_columns: ["commit", "energy-pkg", "energy-core", "energy-gpu"]
    energy_fields: ["energy-pkg", "energy-core"] # analyse 2 metrics only
    min_measurements: 3 # â‰¥3 samples / commit
    drop_outliers: true
    outlier_iqr: 1.5 # Tukey IQR rule

  analysis:
    steps:
      - shapiro_normality
      - welch_t_test
      - change_direction
      - cohen_d
      - pct_change
      - practical_threshold
    thresholds:
      normality_p: 0.05
      welch_p: 0.01
      min_pct_increase: 0.03
      cohen_d: { negligible: 0.2, small: 0.5, medium: 0.8, large: 1.2 }
      pct_change: { minor: 0.05, moderate: 0.10, major: 0.25 }
      practical: { info: 0.05, warning: 0.10, critical: 0.20 }

  plot:
    transforms:
      - module: energytrackr.plot.builtin_data_transforms.load_csv:LoadCSV
        params:
          csv_columns: ["commit", "energy-pkg", "energy-core"]
      - module: energytrackr.plot.builtin_data_transforms.filter_outliers:FilterOutliers
        params:
          column: energy-pkg
          multiplier: 1.5
      - module: energytrackr.plot.builtin_data_transforms.commit_stats:CommitStats
        params:
          column: energy-pkg
          min_measurements: 3
      - module: energytrackr.plot.builtin_data_transforms.compute_distribution:ComputeDistribution
        params:
          column: energy-pkg
          normality_p: 0.05
          min_values_for_normality: 3
      - module: energytrackr.plot.builtin_data_transforms.detect_changes:DetectChanges
        params:
          column: energy-pkg
          thresholds:
            welch_p: 0.05
      - module: energytrackr.plot.builtin_data_transforms.commit_details:CommitDetails

    objects:
      - module: energytrackr.plot.builtin_plot_objects.plot:Plot
      - module: energytrackr.plot.builtin_plot_objects.median_line:MedianLine
        params:
          color: blue
      - module: energytrackr.plot.builtin_plot_objects.error_bars:ErrorBars
      - module: energytrackr.plot.builtin_plot_objects.candlestick:Candlestick
        params:
          default_visible: false
      - module: energytrackr.plot.builtin_plot_objects.dynamic_ticks:DynamicTicks
        params:
          max_ticks: 20
      - module: energytrackr.plot.builtin_plot_objects.change_events:ChangeEventMarkers
      - module: energytrackr.plot.builtin_plot_objects.distribution_scatter:DistributionScatter
        params:
          style:
            normal_color: "blue"
            nonnormal_color: "orange"
            radius: 0.3
            alpha: 0.5
            normal_visible: false
      - module: energytrackr.plot.builtin_plot_objects.legend_policy:LegendPolicy
        params:
          policy: hide

    page:
      - module: energytrackr.plot.builtin_page_sections.base:Base
      - module: energytrackr.plot.builtin_page_sections.plot_embed:PlotEmbed
      - module: energytrackr.plot.builtin_page_sections.level_legend:LevelLegend
      - module: energytrackr.plot.builtin_page_sections.summary_box:SummaryBox
      - module: energytrackr.plot.builtin_page_sections.change_table:ChangeTable
        params:
          columns_conf: columns.yml

  report:
    theme: "dark"
    chart:
      default: "line"
      candlestick_toggle: true
      show_change_events: true
    table:
      columns:
        - { key: short_hash, label: Commit }
        - { key: message, label: Message, width: 30% }
        - { group: stats, include: [n_val, normality] }
        - { key: median_val, label: "Median (J)" }
        - { group: tests, exclude: [effect_cat] }
        - { key: level, label: Level, align: center }

  plugins:
    paths: ["./plot_hooks"]
    entrypoints: ["energytrackr_steps"]
